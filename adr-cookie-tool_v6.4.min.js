/*! Cookie Consent Script - v6.4 Author: Andy Dominique Rak Instagram: https://instagram.com/andydominiquerak */
(function(){
  function tryInit(){
    var banner=document.querySelector('[adr-cookie="banner"]'),
      cookieNameAttr=banner&&banner.getAttribute("data-adr-cookie-name")||"AdrTastyCookie",
      COOKIE_PREFIX=cookieNameAttr+"_",
      COOKIE_NAME=COOKIE_PREFIX+"consent",
      COOKIE_PERFORMANCE=COOKIE_PREFIX+"performance",
      COOKIE_PERSONALIZATION=COOKIE_PREFIX+"personalization",
      COOKIE_ADVERTISEMENT=COOKIE_PREFIX+"advertisement",
      allowButton=document.querySelector('[adr-cookie="allow"]'),
      denyButton=document.querySelector('[adr-cookie="deny"]'),
      prefsButton=document.querySelector('[adr-cookie="prefs"]'),
      modalBg=document.querySelector('[adr-cookie="modal-bg"]'),
      modal=document.querySelector('[adr-cookie="modal"]'),
      modalCloseButton=document.querySelector('[adr-cookie="modal-close"]'),
      saveButton=document.querySelector('[adr-cookie="save"]'),
      editButton=document.querySelector('[adr-cookie="edit"]'),
      perfToggle=document.querySelector('[adr-cookie="perf"]'),
      perfSwitch=document.querySelector('[adr-cookie="perf-switch"]'),
      persToggle=document.querySelector('[adr-cookie="pers"]'),
      persSwitch=document.querySelector('[adr-cookie="pers-switch"]'),
      adToggle=document.querySelector('[adr-cookie="ad"]'),
      adSwitch=document.querySelector('[adr-cookie="ad-switch"]'),
      switchStates={perf:!1,pers:!1,ad:!1};
    if(!banner||!allowButton||!denyButton||!prefsButton||!modalBg||!modal||!modalCloseButton||!saveButton){setTimeout(tryInit,50);return;}
    const slideInAnimation=()=>{gsap.fromTo(banner,{y:"100%",opacity:0},{y:"0%",opacity:1,duration:.5,ease:"power2.out"})},
      slideOutAnimation=t=>{gsap.to(banner,{y:"100%",opacity:0,duration:.5,ease:"power2.in",onComplete:t})},
      showModal=()=>{gsap.set(modalBg,{display:"flex",opacity:0}),gsap.set(modal,{display:"flex",opacity:0,y:100}),gsap.to(modalBg,{opacity:1,duration:.5,ease:"power2.out"}),gsap.to(modal,{y:0,opacity:1,duration:.5,ease:"power2.out"})},
      hideModal=t=>{gsap.to(modal,{y:100,opacity:0,duration:.5,ease:"power2.in",onComplete:()=>{gsap.set(modal,{display:"none"}),t&&t()}}),gsap.to(modalBg,{opacity:0,duration:.5,ease:"power2.in",onComplete:()=>{gsap.set(modalBg,{display:"none"})}})},
      setCookie=(n,t,e)=>{const o=new Date(Date.now()+864e5*e).toUTCString();document.cookie=`${n}=${t}; expires=${o}; path=/`},
      getCookie=n=>{const t=document.cookie.split("; ").find(t=>t.startsWith(n+"="));return t?t.split("=")[1]:null},
      saveSwitchStatesToCookies=()=>{const n=switchStates.perf?"Allowed":"Denied",t=switchStates.pers?"Allowed":"Denied",e=switchStates.ad?"Allowed":"Denied";return setCookie(COOKIE_PERFORMANCE,n,365),setCookie(COOKIE_PERSONALIZATION,t,365),setCookie(COOKIE_ADVERTISEMENT,e,365),setCookie(COOKIE_NAME,switchStates.perf||switchStates.pers||switchStates.ad?"Allowed":"Denied",365),switchStates.perf||switchStates.pers||switchStates.ad},
      toggleSwitch=(e,o)=>{if(!e)return;const n=switchStates[o],t=n?"0%":"100%",s=n?"#ccc":modal?.getAttribute("adr-cookie-brand")||"#f5f500";gsap.to(e,{x:t,backgroundColor:s,duration:.3,ease:"power2.out"}),switchStates[o]=!n},
      initBanner=()=>{const e=getCookie(COOKIE_NAME);"Allowed"===e?gsap.set(banner,{display:"none"}):(gsap.set(banner,{display:"flex"}),slideInAnimation())};

    // SCRIPT UNBLOCKER!
    function runDeferredScripts(){
      var cats=[
        {cc:"performance",cookie:COOKIE_PERFORMANCE},
        {cc:"personalization",cookie:COOKIE_PERSONALIZATION},
        {cc:"advertisement",cookie:COOKIE_ADVERTISEMENT}
      ];
      cats.forEach(function(cat){
        if(getCookie(cat.cookie)==="Allowed"){
          document.querySelectorAll('script[adr-cc="'+cat.cc+'"][type="text/plain"]').forEach(function(origScript){
            var s=document.createElement('script');
            s.type="text/javascript";
            if(origScript.src){s.src=origScript.src;}
            s.text=origScript.textContent;
            document.body.appendChild(s);
          });
        }
      });
    }

    allowButton.addEventListener("click",()=>{setCookie(COOKIE_NAME,"Allowed",365),setCookie(COOKIE_PERFORMANCE,"Allowed",365),setCookie(COOKIE_PERSONALIZATION,"Allowed",365),setCookie(COOKIE_ADVERTISEMENT,"Allowed",365),slideOutAnimation(()=>{gsap.set(banner,{display:"none"});runDeferredScripts();})});
    denyButton.addEventListener("click",()=>{setCookie(COOKIE_NAME,"Denied",365),setCookie(COOKIE_PERFORMANCE,"Denied",365),setCookie(COOKIE_PERSONALIZATION,"Denied",365),setCookie(COOKIE_ADVERTISEMENT,"Denied",365),slideOutAnimation(()=>{gsap.set(banner,{display:"none"})})});
    prefsButton.addEventListener("click",()=>{slideOutAnimation(()=>{gsap.set(banner,{display:"none"}),showModal()})});
    modalCloseButton.addEventListener("click",()=>{hideModal(()=>{gsap.set(banner,{display:"flex"}),slideInAnimation()})});
    saveButton.addEventListener("click",()=>{const e=saveSwitchStatesToCookies();hideModal(()=>{if(e)runDeferredScripts();else gsap.set(banner,{display:"flex"})})});
    editButton&&editButton.addEventListener("click",()=>{showModal()});
    perfToggle?.addEventListener("click",()=>toggleSwitch(perfSwitch,"perf"));
    persToggle?.addEventListener("click",()=>toggleSwitch(persSwitch,"pers"));
    adToggle?.addEventListener("click",()=>toggleSwitch(adSwitch,"ad"));
    initBanner();
    runDeferredScripts(); // For reload case!
  }
  if(document.readyState==="complete"||document.readyState==="interactive"){tryInit();}else{document.addEventListener("DOMContentLoaded",tryInit);}
})();
